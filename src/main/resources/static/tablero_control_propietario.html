<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero de Control - Propietario</title>
    <link rel="stylesheet" href="css/tablero_control_propietario.css">
    <script src="vistaWeb.js"></script>
    <script src='sse.js'></script>
    
</head>
<body>
    <script src="utilesVista.js"></script>
    <div class="tablero-container">
        <!-- Datos del Propietario -->
        <section class="seccion" id="datos-propietario">
            <h2>Datos del Propietario</h2>
            <div id="info-propietario">
                <!-- Los datos del propietario se cargarán dinámicamente -->
            </div>
        </section>

        <!-- Grid de 2 columnas para bonificaciones y vehículos -->
        <div class="grid-50-50">
            <section class="seccion" id="bonificaciones">
                <h2>Bonificaciones Asignadas</h2>
                <div id="lista-bonificaciones">
                    <!-- La tabla de bonificaciones se generará dinámicamente -->
                </div>
            </section>

            <section class="seccion" id="vehiculos">
                <h2>Vehículos Registrados</h2>
                <div id="lista-vehiculos">
                    <!-- La tabla de vehículos se generará dinámicamente -->
                </div>
            </section>
        </div>

        <!-- Sección de Tránsitos -->
        <section class="seccion" id="transitos">
            <h2>Tránsitos Realizados</h2>
            <div id="lista-transitos">
                <!-- La tabla de tránsitos se generará dinámicamente -->
            </div>
        </section>

        <!-- Sección de Notificaciones -->
        <section class="seccion" id="notificaciones">
            <div class="notificaciones-header">
                <h2>Notificaciones</h2>
                <button class="btn-borrar" onclick="borrarNotificaciones()">
                    Borrar todas
                </button>
            </div>
            <ul class="lista-notificaciones" id="lista-notificaciones">
                <!-- Las notificaciones se agregarán dinámicamente -->
            </ul>
        </section>
    </div>

    <script>
        // URL de inicio para la vista
        urlIniciarVista = "/tablero/informacion";
        urlRegistroSSE="/tablero/registrarSSE";
        urlLogin = "login_Propietario.html"

        // Funciones para mostrar los datos recibidos del controlador
        function mostrar_propietario(propietario) {
            const propietarioDiv = document.getElementById('info-propietario');
            propietarioDiv.innerHTML = crearTablaDesdeJson([propietario]);
        }


        function mostrar_asignaciones(asignaciones) {
            console.log("Llegaron asignaciones: ", asignaciones);
            const bonificacionesDiv = document.getElementById('lista-bonificaciones');
            bonificacionesDiv.innerHTML = crearTablaDesdeJson(asignaciones);
        }

        function mostrar_vehiculos(vehiculos) {
            const vehiculosDiv = document.getElementById('lista-vehiculos');
            vehiculosDiv.innerHTML = crearTablaDesdeJson(vehiculos);
        }

        function mostrar_transitosRealizados(transitos) {
            const transitosDiv = document.getElementById('lista-transitos');
            transitosDiv.innerHTML = crearTablaDesdeJson(transitos);
        }

        function mostrar_notificaciones(notificaciones){
            const notificacionesSistema = document.getElementById('lista-notificaciones');
            notificacionesSistema.innerHTML = crearTablaDesdeJson(notificaciones);
        }

        function borrarNotificaciones() {
            const lista = document.getElementById('lista-notificaciones');
            lista.innerHTML = '';
            // Opcional: llamar al backend para marcar como leídas
            submit('/api/propietario/notificaciones/borrar', '');
        }

        function procesarErrorSubmit(status,text){
            if(status==400){
                window.location.href="login_Propietario.html";
            }
        }

        function conexionSSECerrada(event){
            cerrar();
        }

        async function cerrar(){
            let respuesta = await mostrarConfirmacion("Se ha cerrado la aplicacion en esta ventana", "Intenar volver a abrirla", "Cerrar");
            if (respuesta) {
                location.reload();
            } else {
                window.location.href = "index.html"
            }
        }


        opcion1 = "Volver a Login";
        opcion2= "Cerrar";

        async function mostrar_accesoDenegado(mensaje){
            let respuesta = await mostrarConfirmacion(mensaje, opcion1, opcion2);
            moverPagina(respuesta);
        }

        function moverPagina(respuesta){
            if (respuesta) {
                window.location.href = urlLogin;
            }else{
                window.location.href = "index.html";
            }
        }


    </script>
</body>
</html>